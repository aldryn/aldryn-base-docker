#!/bin/bash

mkdir -p /launch

if [[ $PAGESPEED = true ]] || [[ $PAGESPEED = '1' ]] || [[ $PAGESPEED = 1 ]]; then
  echo "PAGESPEED is on (${PAGESPEED})"
  if [[ $BROWSERCACHE = true ]] || [[ $BROWSERCACHE = '1' ]] || [[ $BROWSERCACHE = 1 ]]; then
    echo "BROWSERCACHE is on (${BROWSERCACHE})"
    cp -rvf /app/launch/nginx_pagespeed_and_browsercache/* /launch/
  else
    echo "BROWSERCACHE is off (${BROWSERCACHE})"
    cp -rvf /app/launch/nginx_pagespeed/* /launch/
  fi
else
  echo "PAGESPEED is off (${PAGESPEED})"
  echo "BROWSERCACHE is off (${BROWSERCACHE})"
  cp -rvf /app/launch/no_nginx/* /launch/
fi

echo "adding extra processes from /app/Procfile.extra:"
echo `cat /app/Procfile.extra`
cat /app/Procfile.extra >> /launch/Procfile
exec /launch/start.sh
